<div class="flex flex-col items-center px-40 mt-5">
  <h1 *ngIf="isEditMode">Edit Product</h1>
  <h1 *ngIf="!isEditMode">Add New Product</h1>

  <div class="flex items-center justify-center mt-4 mb-4">
    <form
      class="p-6 bg-white rounded-lg shadow-md border border-gray-300"
      style="width: 90%"
      [formGroup]="productForm"
    >
      <!-- <mat-form-field class="w-full mb-4">
  <mat-label>Category ID</mat-label>
  <mat-select formControlName="categoryId" multiple>
    <mat-option *ngFor="let categories of categoryList " [value]="categories._id">
      {{ categories.name }}
    </mat-option>
  </mat-select>
</mat-form-field> -->

      <mat-form-field
        appearance="outline"
        class="w-full mb-4"
        floatLabel="always"
      >
        <mat-chip-grid #chipGrid>
          <mat-chip-row
            *ngFor="let category of selectedCategories"
            [removable]="true"
            (removed)="removeCategory(category)"
          >
            {{ category.name }}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip-row>

          <input
            matInput
            [placeholder]="selectedCategories.length ? 'Categories' : 'Select Categories'"
            formControlName="categoryId"
            [matAutocomplete]="auto"
            [matChipInputFor]="chipGrid"
            (matChipInputTokenEnd)="addCategoryFromInput($event)"
          />
        </mat-chip-grid>

        <mat-autocomplete
          #auto="matAutocomplete"
          [displayWith]="displayCategoryName"
        >
          <ng-container *ngIf="filteredOptions | async as filtered">
            <mat-option>
              <mat-checkbox
                [checked]="isAllSelected(filtered)"
                (change)="toggleSelectAll(filtered)"
                (click)="$event.stopPropagation()"
              >
                Select All
              </mat-checkbox>
            </mat-option>

            <mat-option *ngFor="let option of filtered" [value]="option">
              <mat-checkbox
                [checked]="isSelected(option)"
                (click)="toggleSelection(option); $event.stopPropagation()"
              >
                {{ option.name }}
              </mat-checkbox>
            </mat-option>
          </ng-container>
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field class="w-full mb-4">
        <mat-label>Brands</mat-label>
        <mat-select formControlName="brandId" multiple>
          <mat-option *ngFor="let brands of brandList" [value]="brands._id">
            {{ brands.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field class="w-full mb-4">
        <mat-label>Product Name</mat-label>
        <input matInput type="text" formControlName="name" required />
      </mat-form-field>
      <mat-form-field class="w-full mb-4">
        <mat-label>Short Description</mat-label>
        <input
          matInput
          type="text"
          formControlName="shortDescription"
          required
        />
      </mat-form-field>

      <mat-form-field class="w-full mb-4">
        <mat-label>Description</mat-label>
        <textarea
          matInput
          type="text"
          formControlName="description"
          rows="5"
          required
        >
        </textarea>
      </mat-form-field>

      <mat-form-field class="w-full mb-4">
        <mat-label>Price</mat-label>
        <input matInput type="text" formControlName="price" required />
      </mat-form-field>

      <mat-form-field class="w-full">
        <mat-label>Discount</mat-label>
        <input matInput type="text" formControlName="discount" required />
      </mat-form-field>

      <div class="w-full mb-4">
        <mat-checkbox class="example-margin" formControlName="isFeatured"
          >Is Featured</mat-checkbox
        >
        <mat-checkbox class="example-margin" formControlName="isNewProduct"
          >Is New</mat-checkbox
        >
      </div>
      <label
        (click)="print()"
        class="block mb-1 font-medium text-gray-700"
        *ngIf="images().length > 0"
      >
        <span *ngIf="images().length > 1">Images</span>
        <span *ngIf="images().length === 1">Image</span>
      </label>

      <button
        mat-raised-button
        color="primary"
        (click)="addImage()"
        type="button"
        class="mb-2"
      >
        Add Image
      </button>
      <button
        mat-raised-button
        color="warn"
        type="button"
        class="mb-2"
        (click)="removeImage()"
      >
        Remove Image
      </button>
      <div *ngIf="images().length > 0">
        <!-- //imageUrl with mat-form-field -->
        <div formArrayName="images" class="flex flex-wrap gap-4">
          <div
            *ngFor="let img of images().controls; let i = index"
            [formGroupName]="i"
          >
            <mat-form-field class="w-full mb-4">
              <mat-label>Image URL</mat-label>
              <input
                matInput
                type="text"
                formControlName="image"
                required
                placeholder="Enter image URL"
              />
            </mat-form-field>
          </div>
          <!-- <label (click)="print()"
        class="block mb-1 font-medium text-gray-700"
        *ngIf="images().length > 0"
      >
        <span *ngIf="images().length > 1">Images</span>
        <span *ngIf="images().length === 1">Image</span>
      </label>   -->
          <!-- <button
        mat-raised-button
        color="primary"
        (click)="addImage()"
        type="button"
        class="mb-2"
      >
        Add Image
      </button>
      <button
        mat-raised-button
        color="warn"
        type="button"
        class="mb-2"
      >
        Remove Image
      </button>

      <div formArrayName="image" class="flex flex-wrap gap-4">
  <div
    *ngFor="let img of images().controls; let i = index"
    [formGroupName]="i"
    class="relative w-48 h-56 border rounded bg-gray-100 p-2"
  >
    <img
      *ngIf="img.value.preview"
      [src]="img.value.preview"
      class="w-full h-40 object-contain border rounded"
      alt="Image Preview"
    />

    <button
      type="button"
      (click)="removeImage(i)"
      class="absolute top-1 right-1 bg-red-600 hover:bg-red-700 text-white rounded-full w-7 h-7 flex items-center justify-center text-xs shadow"
      title="Remove Image"
    >
      üóëÔ∏è
    </button>

    <input
      type="file"
      accept="image/*"
      (change)="onImageSelected($event, i)"
      class="mt-2 w-full text-xs"
    />
  </div>
</div> -->
        </div>
      </div>
      <div class="flex justify-end mt-6">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!productForm.valid"
          class="mr-2"
          (click)="save()"
        >
          {{ buttonName }}
        </button>
        <button mat-raised-button color="warn" type="reset">Reset</button>
      </div>
    </form>
  </div>
</div>
